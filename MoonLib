local MoonLib = {Version = "4.1"}
local UserInputService = game:GetService("User InputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

-- Настройки тем
local Themes = {
    Aurora = {
        Main = Color3.fromRGB(25, 28, 42),
        Secondary = Color3.fromRGB(35, 40, 60),
        Text = Color3.fromRGB(230, 235, 255),
        Accent = Color3.fromRGB(100, 150, 255),
        Shadow = Color3.fromRGB(15, 20, 30),
        ScrollBar = Color3.fromRGB(80, 130, 220),
        Slider = Color3.fromRGB(70, 120, 210),
        Toggle = Color3.fromRGB(90, 140, 230),
        Dropdown = Color3.fromRGB(45, 50, 70),
        Divider = Color3.fromRGB(60, 70, 90),
        Warning = Color3.fromRGB(255, 120, 100),
        Success = Color3.fromRGB(100, 220, 150),
        Input = Color3.fromRGB(35, 40, 55),
        Overlay = Color3.fromRGB(20, 25, 35)
    },
    Midnight = {
        Main = Color3.fromRGB(20, 22, 30),
        Secondary = Color3.fromRGB(30, 33, 45),
        Text = Color3.fromRGB(220, 225, 240),
        Accent = Color3.fromRGB(120, 80, 220),
        Shadow = Color3.fromRGB(10, 12, 20),
        ScrollBar = Color3.fromRGB(100, 80, 200),
        Slider = Color3.fromRGB(90, 70, 190),
        Toggle = Color3.fromRGB(110, 90, 210),
        Dropdown = Color3.fromRGB(40, 45, 60),
        Divider = Color3.fromRGB(50, 55, 70),
        Warning = Color3.fromRGB(220, 100, 100),
        Success = Color3.fromRGB(90, 200, 120),
        Input = Color3.fromRGB(30, 35, 50),
        Overlay = Color3.fromRGB(15, 20, 30)
    }
}

MoonLib.Theme = "Aurora"
MoonLib.WindowMinimizeKey = Enum.KeyCode.RightAlt
MoonLib.Visible = true
MoonLib.Configs = {}
MoonLib.CurrentConfig = "Default"
MoonLib.Transparency = 0
MoonLib.MaxTransparency = 0.5 -- Максимальная прозрачность
MoonLib.Notifications = {}

-- Утилиты
local function RippleEffect(button, color)
    local ripple = Instance.new("Frame")
    ripple.Name = "Ripple"
    ripple.BackgroundColor3 = color or Color3.fromRGB(255, 255, 255)
    ripple.BackgroundTransparency = 0.8
    ripple.ZIndex = 10
    ripple.Parent = button
    
    local mouse = game:GetService("Players").LocalPlayer:GetMouse()
    local pos = Vector2.new(mouse.X - button.AbsolutePosition.X, mouse.Y - button.AbsolutePosition.Y)
    ripple.Position = UDim2.new(0, pos.X, 0, pos.Y)
    
    local tween = TweenService:Create(
        ripple,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {
            BackgroundTransparency = 1,
            Size = UDim2.new(0, button.AbsoluteSize.X*2, 0, button.AbsoluteSize.X*2),
            Position = UDim2.new(0.5, -button.AbsoluteSize.X, 0.5, -button.AbsoluteSize.X)
        }
    )
    
    tween:Play()
    tween.Completed:Connect(function()
        ripple:Destroy()
    end)
end

local function RoundCorners(obj, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 6)
    corner.Parent = obj
    return corner
end

local function UpdateTransparency(window, transparency)
    for _, element in pairs(window:GetDescendants()) do
        if element:IsA("Frame") and element.BackgroundTransparency < 1 then
            element.BackgroundTransparency = element:GetAttribute("BaseTransparency") or 0 + transparency
        elseif element:IsA("TextLabel") or element:IsA("TextButton") or element:Is
        elseif element:IsA("TextLabel") or element:IsA("TextButton") or element:IsA("TextBox") then
            element.TextTransparency = transparency
        elseif element:IsA("ImageLabel") or element:IsA("ImageButton") then
            element.ImageTransparency = transparency
        end
    end
end

-- Система уведомлений
function MoonLib.Notify(title, text, duration)
    duration = duration or 5
    
    local currentTheme = Themes[MoonLib.Theme]
    local ScreenGui = game:GetService("CoreGui"):FindFirstChild("MoonLibNotifications") or Instance.new("ScreenGui")
    ScreenGui.Name = "MoonLibNotifications"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game:GetService("CoreGui")
    
    local Notification = Instance.new("Frame")
    Notification.Name = "Notification_"..tostring(#MoonLib.Notifications + 1)
    Notification.BackgroundColor3 = currentTheme.Notification
    Notification.BackgroundTransparency = 1
    Notification.BorderSizePixel = 0
    Notification.Position = UDim2.new(1, 0, 1, -50 - (#MoonLib.Notifications * 60))
    Notification.Size = UDim2.new(0, 300, 0, 50)
    Notification.AnchorPoint = Vector2.new(1, 1)
    Notification.ZIndex = 20
    RoundCorners(Notification, 8)
    
    local Shadow = Instance.new("ImageLabel")
    Shadow.Name = "Shadow"
    Shadow.BackgroundTransparency = 1
    Shadow.Position = UDim2.new(0, -10, 0, -10)
    Shadow.Size = UDim2.new(1, 20, 1, 20)
    Shadow.ZIndex = 19
    Shadow.Image = "rbxassetid://1316045217"
    Shadow.ImageColor3 = currentTheme.Shadow
    Shadow.ScaleType = Enum.ScaleType.Slice
    Shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    Shadow.Parent = Notification
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "Title"
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Position = UDim2.new(0, 10, 0, 5)
    TitleLabel.Size = UDim2.new(1, -10, 0, 20)
    TitleLabel.Font = Enum.Font.GothamSemibold
    TitleLabel.Text = title
    TitleLabel.TextColor3 = currentTheme.Text
    TitleLabel.TextSize = 14
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.ZIndex = 21
    TitleLabel.Parent = Notification
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.Name = "Text"
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 10, 0, 25)
    TextLabel.Size = UDim2.new(1, -10, 0, 20)
    TextLabel.Font = Enum.Font.Gotham
    TextLabel.Text = text
    TextLabel.TextColor3 = currentTheme.Text
    TextLabel.TextTransparency = 0.2
    TextLabel.TextSize = 12
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.ZIndex = 21
    TextLabel.Parent = Notification
    
    Notification.Parent = ScreenGui
    
    -- Анимация появления
    local appearTween = TweenService:Create(
        Notification,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {
            BackgroundTransparency = 0,
            Position = UDim2.new(1, -10, 1, -50 - (#MoonLib.Notifications * 60))
        }
    )
    appearTween:Play()
    
    table.insert(MoonLib.Notifications, Notification)
    
    -- Анимация исчезновения
    delay(duration, function()
        local disappearTween = TweenService:Create(
            Notification,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {
                BackgroundTransparency = 1,
                Position = UDim2.new(1, 0, 1, -50 - (#MoonLib.Notifications * 60))
            }
        )
        disappearTween:Play()
        
        disappearTween.Completed:Wait()
        Notification:Destroy()
        
        -- Обновляем позиции оставшихся уведомлений
        for i, notif in ipairs(MoonLib.Notifications) do
            if notif == Notification then
                table.remove(MoonLib.Notifications, i)
                table.remove(MoonLib.Notifications, i)
                break
            end
        end
        
        for i, notif in ipairs(MoonLib.Notifications) do
            TweenService:Create(
                notif,
                TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {
                    Position = UDim2.new(1, -10, 1, -50 - ((i-1) * 60))
                }
            ):Play()
        end
    end)

    return Notification
end

-- Основные функции
function MoonLib.SetTheme(themeName)
    if Themes[themeName] then
        MoonLib.Theme = themeName
        -- Обновление всех элементов GUI при смене темы
        UpdateTransparency(game:GetService("CoreGui"):FindFirstChild("MoonLibGUI"), MoonLib.Transparency)
    else
        warn("Тема '"..themeName.."' не найдена. Используется тема по умолчанию.")
    end
end

function MoonLib.SaveConfig(configName)
    MoonLib.Configs[configName] = {
        Theme = MoonLib.Theme,
        Transparency = MoonLib.Transparency,
        WindowMinimizeKey = MoonLib.WindowMinimizeKey
        -- Здесь можно добавить другие настройки для сохранения
    }
    MoonLib.CurrentConfig = configName
end

function MoonLib.LoadConfig(configName)
    if MoonLib.Configs[configName] then
        local config = MoonLib.Configs[configName]
        MoonLib.SetTheme(config.Theme)
        MoonLib.Transparency = config.Transparency
        MoonLib.WindowMinimizeKey = config.WindowMinimizeKey
        MoonLib.CurrentConfig = configName
        return true
    end
    return false
end

function MoonLib.CreateWindow(title, subtitle)
    local currentTheme = Themes[MoonLib.Theme]
    
    -- Создаем уведомление о запуске
    MoonLib.Notify("MoonLib", "MoonLib - Created", 3)
    
    local ScreenGui = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    
    -- Настройка ScreenGui
    ScreenGui.Name = "MoonLibGUI"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false
    
    -- Настройка MainFrame с начальной прозрачностью для анимации
    MainFrame.Name = "MainFrame"
    MainFrame.BackgroundColor3 = currentTheme.Main
    MainFrame.BackgroundTransparency = 1
    MainFrame:SetAttribute("BaseTransparency", 0)
    MainFrame.BorderSizePixel = 0
    MainFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
    MainFrame.Size = UDim2.new(0, 450, 0, 500)
    MainFrame.ClipsDescendants = true
    RoundCorners(MainFrame, 12)
    
    -- Тень
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "Shadow"
    shadow.BackgroundTransparency = 1
    shadow.Position = UDim2.new(0, -15, 0, -15)
    shadow.Size = UDim2.new(1, 30, 1, 30)
    shadow.ZIndex = -1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = currentTheme.Shadow
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.Parent = MainFrame
    
    -- Верхняя панель
    local TopBar = Instance.new("Frame")
    TopBar.Name = "TopBar"
    TopBar.BackgroundColor3 = currentTheme.Secondary
    TopBar.BackgroundTransparency = MoonLib.Transparency
    TopBar:SetAttribute("BaseTransparency", 0)
    TopBar.BorderSizePixel = 0
    TopBar.Size = UDim2.new(1, 0, 0, 60)
    RoundCorners(TopBar, 12)
    TopBar.ZIndex = 2

    -- Заголовок
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.BackgroundTransparency = 1
    Title.TextTransparency = MoonLib.Transparency
    Title.Position = UDim2.new(0, 15, 0, 10)
    Title.Size = UDim2.new(1, -30, 0, 24)
    Title.Font = Enum.Font.GothamSemibold
    Title.Text = title or "MoonLib Window"
    Title.TextColor3 = currentTheme.Text
    Title.TextSize = 18
    Title.TextXAlignment = Enum.TextX
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.ZIndex = 3
    Title.Parent = TopBar

    -- Кнопка закрытия
    local CloseButton = Instance.new("TextButton")
    CloseButton.Name = "CloseButton"
    CloseButton.BackgroundTransparency = 1
    CloseButton.Position = UDim2.new(1, -50, 0, 10)
    CloseButton.Size = UDim2.new(0, 40, 0, 24)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.Text = "X"
    CloseButton.TextColor3 = currentTheme.Text
    CloseButton.TextSize = 18
    CloseButton.TextXAlignment = Enum.TextXAlignment.Center
    CloseButton.ZIndex = 3
    CloseButton.Parent = TopBar

    -- Обработчик нажатия кнопки закрытия
    CloseButton.MouseButton1Click:Connect(function()
        -- Анимация исчезновения окна
        local disappearTween = TweenService:Create(
            MainFrame,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {
                BackgroundTransparency = 1
            }
        )
        disappearTween:Play()
        disappearTween.Completed:Wait()
        ScreenGui:Destroy()
    end)

    -- Добавляем верхнюю панель в основное окно
    TopBar.Parent = MainFrame
    MainFrame.Parent = ScreenGui

    -- Анимация появления основного окна
    local appearTween = TweenService:Create(
        MainFrame,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {
            BackgroundTransparency = 0
        }
    )
    appearTween:Play()

    -- Добавляем GUI в CoreGui
    ScreenGui.Parent = game:GetService("CoreGui")

    return MainFrame
end

-- Инициализация MoonLib
MoonLib.Notifications = {}
MoonLib.Configs = {}
MoonLib.Theme = "Default"
MoonLib.Transparency = 0.2
MoonLib.WindowMinimizeKey = Enum.KeyCode.M

-- Пример использования
MoonLib.CreateWindow("Welcome", "This is your new GUI!")
