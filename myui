local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local FoxesLib = {}

-- Утилита для закругленных углов
local function addUICorner(instance, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 10)
    corner.Parent = instance
end

-- GUI основное окно
function FoxesLib:CreateMain(title, logoId)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FoxesLibrary"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = CoreGui

    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0.4, 0, 0.6, 0)
    mainFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = false
    mainFrame.Parent = screenGui
    addUICorner(mainFrame)

    -- Анимация появления
    local function showGUI()
        mainFrame.Visible = true
        mainFrame.BackgroundTransparency = 1
        local tween = TweenService:Create(
            mainFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {BackgroundTransparency = 0}
        )
        tween:Play()
    end

    -- Анимация закрытия
    local function closeGUI()
        local tween = TweenService:Create(
            mainFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {BackgroundTransparency = 1}
        )
        tween:Play()
        tween.Completed:Connect(function()
            mainFrame.Visible = false
        end)
    end

    -- Добавляем верхний бар с лого и кнопкой закрытия
    local topBar = Instance.new("Frame")
    topBar.Size = UDim2.new(1, 0, 0.1, 0)
    topBar.BackgroundColor3 = Color3.fromRGB(255, 165, 0) 
    topBar.BorderSizePixel = 0
    topBar.Parent = mainFrame
    addUICorner(topBar)

    local logo = Instance.new("ImageLabel")
    logo.Size = UDim2.new(0.15, 0, 0.8, 0)
    logo.Position = UDim2.new(0.02, 0, 0.1, 0)
    logo.Image = logoId or "rbxassetid://0"
    logo.BackgroundTransparency = 1
    logo.Parent = topBar

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(0.7, 0, 0.8, 0)
    titleLabel.Position = UDim2.new(0.2, 0, 0.1, 0)
    titleLabel.Text = title or "Foxes Library"
    titleLabel.TextScaled = true
    titleLabel.BackgroundTransparency = 1
    titleLabel.Parent = topBar

    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0.1, 0, 0.8, 0)
    closeButton.Position = UDim2.new(0.9, 0, 0.1, 0)
    closeButton.Text = "X"
    closeButton.TextScaled = true
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    closeButton.Parent = topBar
    addUICorner(closeButton)

    closeButton.MouseButton1Click:Connect(closeGUI)

    local dragging
    local dragStart
    local startPos

    topBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    topBar.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)

    return {
        Show = showGUI,
        Close = closeGUI
    }
end

function FoxesLib:AddButton(parent, text, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0.8, 0, 0.1, 0)
    button.Position = UDim2.new(0.1, 0, 0, 0)
    button.Text = text
    button.TextScaled = true
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    button.Parent = parent
    addUICorner(button)

    button.MouseButton1Click:Connect(function()
        if callback then
            callback()
        end
    end)
end

function FoxesLib:AddSlider(parent, minVal, maxVal, defaultVal, callback)
    local slider = Instance.new("Frame")
    slider.Size = UDim2.new(0.8, 0, 0.1, 0)
    slider.Position = UDim2.new(0.1, 0, 0, 0)
    slider.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    slider.Parent = parent
    addUICorner(slider)

    local handle = Instance.new("Frame")
    handle.Size = UDim2.new(0.1, 0, 1, 0)
    handle.Position = UDim2.new(0, 0, 0, 0)
    handle.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
    handle.Parent = slider
    addUICorner(handle)

    handle.MouseButton1Down:Connect(function()
        handle.MouseMoved:Connect(function(mouseX)
            local newPosition = math.clamp(mouseX / slider.AbsoluteSize.X, 0, 1)
            handle.Position = UDim2.new(newPosition, 0, 0, 0)
            if callback then
                callback(math.floor(minVal + newPosition * (maxVal - minVal)))
            end
        end)
    end)
end

return FoxesLib
